<Window
    x:Class="Surveyor.User_Controls.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls" 
    xmlns:surveyor="using:Surveyor" 
    xmlns:surveyorControls="using:Surveyor.User_Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    Title="Settings">

    <Grid x:Name="RootGrid" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>


        <!-- Custom Title Bar Area -->
        <Grid x:Name="AppTitleBar" Background="Transparent" Height="40" Grid.Row="0">

        </Grid>

        <ScrollViewer
            x:Name="contentSV"
            Grid.Row="1"
            Padding="36,0,36,0"
            IsTabStop="False"
            UseSystemFocusVisuals="False"
            VerticalScrollBarVisibility="Auto"
            VerticalScrollMode="Auto">
            <StackPanel Spacing="{StaticResource SettingsCardSpacing}">
                <StackPanel.ChildrenTransitions>
                    <EntranceThemeTransition FromVerticalOffset="50" />
                    <RepositionThemeTransition IsStaggeringEnabled="False" />
                </StackPanel.ChildrenTransitions>
                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Settings" />

                
                <!--SURVEY SETTINGS-->
                <toolkit:SettingsExpander x:Name="SurveySettingsExpander" Header="Survey Settings" MaxWidth="1200">
                    <toolkit:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE160;" />
                    </toolkit:SettingsExpander.HeaderIcon>
                    
                    <toolkit:SettingsExpander.Items>
                        <!--Survey Info and Media-->
                        <toolkit:SettingsExpander Header="Survey Info &amp; Media">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <FontIcon Glyph="&#xF0E3;" ToolTipService.ToolTip="Survey setup information and survey media"/>
                            </toolkit:SettingsExpander.HeaderIcon>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="ReCalculate" Content="Re-Calculate" Click="ReCalculate_Click" Margin="0,0,10,0"/>
                                <TextBlock
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    IsTextSelectionEnabled="True"
                                    Text="{x:Bind SettingsExpanderInfoText}" />
                            </StackPanel>
                            
                            <toolkit:SettingsExpander.Items>
                                <toolkit:SettingsCard x:Name="SettingsCardSurveyInfoAndMedia">
                                    <surveyorControls:SurveyInfoAndMedia x:Name="SurveyInfoAndMedia"/>
                                </toolkit:SettingsCard>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>
                       
                        <!--Calibration-->
                        <toolkit:SettingsCard Header="Calibration"
                                          ToolTipService.ToolTip="Calibration information for the stereo camera rig.">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xEB3C;" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <ToggleSwitch x:Name="magnifierWindowAutomaticXXX" Toggled="MagnifierWindowAutomatic_Toggled" />
                        </toolkit:SettingsCard>

                        <!--Survey Rules-->
                        <toolkit:SettingsExpander Header="Survey Rules" x:Name="SettingsExpanderSurveyRules">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <FontIcon Glyph="&#xE73E;" />
                            </toolkit:SettingsExpander.HeaderIcon>
                            
                            <ToggleSwitch x:Name="surveyRulesActive" IsOn="{x:Bind survey.Data.SurveyRules.SurveyRulesActive, Mode=TwoWay}"/>
                            <toolkit:SettingsExpander.Items>
                                <surveyorControls:SettingsSurveyRules x:Name="SettingsSurveyRules"/>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>

                    </toolkit:SettingsExpander.Items>
                </toolkit:SettingsExpander>


                <!--GENERAL SETTINGS-->
                <toolkit:SettingsExpander x:Name="GeneralSettingsExpander" Header="General Settings" MaxWidth="1200">
                    <toolkit:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE115;" />
                    </toolkit:SettingsExpander.HeaderIcon>

                    <toolkit:SettingsExpander.Items>
                        <toolkit:SettingsCard Description="Select which app theme to display" Header="App theme">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xE790;" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <ComboBox x:Name="themeMode" AutomationProperties.AutomationId="themeModeComboBox" SelectionChanged="ThemeMode_SelectionChanged">
                                <ComboBoxItem Content="Light" Tag="Light" />
                                <ComboBoxItem Content="Dark" Tag="Dark" />
                                <ComboBoxItem Content="Use system setting" Tag="Default" />
                            </ComboBox>
                        </toolkit:SettingsCard>

                        <toolkit:SettingsCard Header="Magnifier Window Automatic"
                                          ToolTipService.ToolTip="This automatically shows the magnifier window when you hover over either the left or right survey video. If it is switched off you need to left-click the area of the video frame when you want the magnifier window to appear.">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xE71E;" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <ToggleSwitch x:Name="MagnifierWindowAutomatic" Toggled="MagnifierWindowAutomatic_Toggled" />
                        </toolkit:SettingsCard>

                        <toolkit:SettingsCard Header="Diagnostic Information">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xEBE8;" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <ToggleSwitch x:Name="DiagnosticInformation" Toggled="DiagnosticInformation_Toggled" />
                        </toolkit:SettingsCard>

                        <toolkit:SettingsCard Header="Teaching Tips">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xE7BE;" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="ReshowTeachingTips" Content="Reshow Tips" Click="ReshowTeachingTips_Click" Margin="0,0,10,0"/>
                                <ToggleSwitch x:Name="TeachingTips" Toggled="TeachingTips_Toggled" />
                            </StackPanel>
                        </toolkit:SettingsCard>

                    </toolkit:SettingsExpander.Items>
                </toolkit:SettingsExpander>

                <!-- CAMERA -->
                <toolkit:SettingsExpander Header="Camera" MaxWidth="1200">
                    <toolkit:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE722;" />
                    </toolkit:SettingsExpander.HeaderIcon>
                                            
                    <toolkit:SettingsExpander.Items>
                        <toolkit:SettingsCard Header="GoPro Setup" HorizontalContentAlignment="Left" ContentAlignment="Vertical">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xED14;" />
                            </toolkit:SettingsCard.HeaderIcon>
                        </toolkit:SettingsCard>

                        <StackPanel Orientation="Vertical" Margin="50,10,50,0">
                            <TextBlock>
                                <TextBlock.Inlines>
                                    <Run Text="The GoPro survey cameras must have GoPro Labs installed on each camera. Follow the link to " />
                                    <Hyperlink NavigateUri="https://gopro.github.io/labs/">
                                        <Run Text="GoPro Labs" />
                                    </Hyperlink>
                                    <Run Text=".  Download the correct version for your GoPro." />
                                </TextBlock.Inlines>
                            </TextBlock>
                            <TextBlock Text="After Labs is installed on each GoPro switch each camera on and point at the QR Code below. After the GoPro has read the QR Code switch the camera off." TextWrapping="WrapWholeWords"/>
                            <TextBlock Text="The QR Code sets up the following:" TextWrapping="WrapWholeWords" Margin="0,10,0,0"/>
                            <TextBlock Margin="10,0,0,0">
                                <Run Text="• Sets the maximum MP4 file size of 64Gb" /><LineBreak/>
                                <Run Text="• Set the required resolution and frame rate" /><LineBreak/>
                                <Run Text="• Once switched on the GoPros will start recording with a firm shake of the camera rig" />
                            </TextBlock>
                            <Grid Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="50*"/>
                                    <ColumnDefinition Width="50*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Left">
                                    <DropDownButton x:Name="GoProQRSelection" Grid.Column="0" HorizontalAlignment="Left"  VerticalAlignment="Top" Content="Standard Setup">
                                        <DropDownButton.Flyout>
                                            <MenuFlyout x:Name="GoProQRSelectionFlyout"/>
                                        </DropDownButton.Flyout>
                                    </DropDownButton>
                                    <TextBlock x:Name="GoProQRScript" Text="" Grid.Column="0" Style="{StaticResource CaptionTextBlockStyle}" Margin="0,10,0,0" TextWrapping="WrapWholeWords"/>
                                </StackPanel>
                                <Image x:Name="GoProQRCode"  HorizontalAlignment="Right" Grid.Column="1" Width="400" Height="400" Margin="10,0,00,0"/>
                            </Grid>
                        </StackPanel>

                    </toolkit:SettingsExpander.Items>
                </toolkit:SettingsExpander>

                <!--  ABOUT  -->
                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="About" />
                <toolkit:SettingsExpander Description="© 2025 All rights reserved." Header="{StaticResource AppTitleName}" MaxWidth="1200">
                    <toolkit:SettingsExpander.HeaderIcon>
                        <BitmapIcon x:Name="AboutAppIcon" ShowAsMonochrome="False" UriSource="/Assets/surveyor-dark.png" />
                    </toolkit:SettingsExpander.HeaderIcon>
                    <TextBlock
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        IsTextSelectionEnabled="True"
                        Text="{x:Bind Version}" />
                    <toolkit:SettingsExpander.Items>

                        <toolkit:SettingsCard
                            HorizontalContentAlignment="Left"
                            ContentAlignment="Vertical"
                            Header="Dependencies &amp; references">
                            <StackPanel Margin="-12,0,0,0" Orientation="Vertical">
                                <HyperlinkButton Content="{x:Bind WinAppSdkRuntimeDetails}" NavigateUri="https://aka.ms/windowsappsdk" />
                                <HyperlinkButton Content="Windows UI Library" NavigateUri="https://aka.ms/winui" />
                                <HyperlinkButton Content="Windows Community Toolkit" NavigateUri="https://aka.ms/toolkit/windows" />
                                <HyperlinkButton Content="Win2D" NavigateUri="https://github.com/Microsoft/Win2D" />
                                <HyperlinkButton Content="OpenCV Apache 2.0 License"  NavigateUri="https://www.apache.org/licenses/LICENSE-2.0"/>
                                <HyperlinkButton Content="Emgu.CV GPL V3" NavigateUri="https://www.nuget.org/packages/Emgu.CV" />
                                <HyperlinkButton Content="Math.NET Numerics MIT License" NavigateUri="https://numerics.mathdotnet.com" />
                                <HyperlinkButton Content="Json.NET MIT License" NavigateUri="https://www.newtonsoft.com/json" />
                                <HyperlinkButton Content="Snorkeling mask icon from Noun Project CC BY 3.0" NavigateUri="https://thenounproject.com/icon/snorkeling-mask-1541410/" />
                                <HyperlinkButton Content="Media icon by Thea Graph from Noun Project CC BY 3.0" NavigateUri="https://thenounproject.com/browse/icons/term/media/" />
                                
                            </StackPanel>
                        </toolkit:SettingsCard>
                       
                    </toolkit:SettingsExpander.Items>
                </toolkit:SettingsExpander>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
