<Window
    x:Class="Surveyor.User_Controls.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"   
    xmlns:dg="using:CommunityToolkit.WinUI.UI.Controls"   
    xmlns:surveyor="using:Surveyor" 
    xmlns:surveyorControls="using:Surveyor.User_Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    Title="Settings">


    <Grid x:Name="RootGrid" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

        <Grid.Resources>
            <surveyorControls:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </Grid.Resources>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>


        <!-- Custom Title Bar Area -->
        <Grid x:Name="AppTitleBar" Background="Transparent" Height="40" Grid.Row="0">

        </Grid>

        <ScrollViewer
            x:Name="contentSV"
            Grid.Row="1"
            Padding="36,0,36,0"
            IsTabStop="False"
            UseSystemFocusVisuals="False"
            VerticalScrollBarVisibility="Auto"
            VerticalScrollMode="Auto">
            <StackPanel Spacing="{StaticResource SettingsCardSpacing}">
                <StackPanel.ChildrenTransitions>
                    <EntranceThemeTransition FromVerticalOffset="50" />
                    <RepositionThemeTransition IsStaggeringEnabled="False" />
                </StackPanel.ChildrenTransitions>
                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Settings" />

                
                <!--SURVEY SETTINGS-->
                <toolkit:SettingsExpander x:Name="SurveySettingsExpander" Header="Survey Settings" MaxWidth="1200">
                    <toolkit:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE160;" />
                    </toolkit:SettingsExpander.HeaderIcon>
                    
                    <toolkit:SettingsExpander.Items>
                        <!--Survey Info and Media-->
                        <toolkit:SettingsExpander Header="Survey Info &amp; Media">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <FontIcon Glyph="&#xF0E3;" ToolTipService.ToolTip="Survey setup information and survey media"/>
                            </toolkit:SettingsExpander.HeaderIcon>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="ReCalculate" Content="Re-Calculate" Click="ReCalculate_Click" Margin="0,0,10,0"/>
                                <TextBlock
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    IsTextSelectionEnabled="True"
                                    Text="{x:Bind SettingsExpanderInfoText}" 
                                    VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <toolkit:SettingsExpander.Items>
                                <toolkit:SettingsCard x:Name="SettingsCardSurveyInfoAndMedia">
                                    <surveyorControls:SurveyInfoAndMedia x:Name="SurveyInfoAndMedia"/>
                                </toolkit:SettingsCard>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>
                       
                        <!--Calibration-->
                        <toolkit:SettingsCard Header="Calibration"
                                          ToolTipService.ToolTip="Calibration information for the stereo camera rig.">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xEB3C;" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <!--<ToggleSwitch x:Name="magnifierWindowAutomaticXXX" Toggled="MagnifierWindowAutomatic_Toggled" />-->
                        </toolkit:SettingsCard>

                        <!-- Species -->
                        <toolkit:SettingsCard Header="Species"
                                          ToolTipService.ToolTip="Species lookup list data">
                            <toolkit:SettingsCard.HeaderIcon>
                                <BitmapIcon x:Name="SpeciesIcon" ShowAsMonochrome="False" UriSource="/Assets/fish-dark.png" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <!--<ToggleSwitch x:Name="magnifierWindowAutomaticXXX" Toggled="MagnifierWindowAutomatic_Toggled" />-->
                        </toolkit:SettingsCard>

                        <!--Survey Rules-->
                        <toolkit:SettingsExpander Header="Survey Rules" x:Name="SettingsExpanderSurveyRules">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <FontIcon Glyph="&#xE73E;" />
                            </toolkit:SettingsExpander.HeaderIcon>
                            <ToggleSwitch x:Name="surveyRulesActive" IsOn="{x:Bind survey.Data.SurveyRules.SurveyRulesActive, Mode=TwoWay}"/>
                            
                            <toolkit:SettingsExpander.Items>
                                <surveyorControls:SettingsSurveyRules x:Name="SettingsSurveyRules"/>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>

                    </toolkit:SettingsExpander.Items>
                </toolkit:SettingsExpander>


                <!--GENERAL SETTINGS-->
                <toolkit:SettingsExpander x:Name="GeneralSettingsExpander" Header="General Settings" MaxWidth="1200">
                    <toolkit:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE115;" />
                    </toolkit:SettingsExpander.HeaderIcon>

                    <toolkit:SettingsExpander.Items>
                        <!-- Auto Save -->
                        <toolkit:SettingsCard Header="Auto Save">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xE74E;" ToolTipService.ToolTip="If enabled work is saved automatically every 20 secs."/>
                            </toolkit:SettingsCard.HeaderIcon>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <ToggleSwitch x:Name="AutoSave" Toggled="AutoSave_Toggled" />
                            </StackPanel>
                        </toolkit:SettingsCard>

                        <!-- Theme -->
                        <toolkit:SettingsCard Description="Select which app theme to display" Header="App theme">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xE790;" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <ComboBox x:Name="themeMode" AutomationProperties.AutomationId="themeModeComboBox" SelectionChanged="ThemeMode_SelectionChanged">
                                <ComboBoxItem Content="Light" Tag="Light" />
                                <ComboBoxItem Content="Dark" Tag="Dark" />
                                <ComboBoxItem Content="Use system setting" Tag="Default" />
                            </ComboBox>
                        </toolkit:SettingsCard>

                        <!-- Internet -->
                        <toolkit:SettingsCard Header="Use Internet">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xE701;" ToolTipService.ToolTip="When the internet is available the application is allowed to download images and upload data."/>
                            </toolkit:SettingsCard.HeaderIcon>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="UseInternetResetDownloadUploadList" Content="Reset Download/Upload List" Click="UseInternetResetDownloadUploadList_Click" Margin="0,0,10,0"/>
                                <ToggleSwitch x:Name="UseInternet" Toggled="UseInternet_Toggled" />
                            </StackPanel>
                        </toolkit:SettingsCard>

                        <!-- Teaching Tips -->
                        <toolkit:SettingsCard Header="Teaching Tips">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xE7BE;" />
                            </toolkit:SettingsCard.HeaderIcon>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="ReshowTeachingTips" Content="Reshow Tips" Click="ReshowTeachingTips_Click" Margin="0,0,10,0"/>
                                <ToggleSwitch x:Name="TeachingTips" Toggled="TeachingTips_Toggled" />
                            </StackPanel>
                        </toolkit:SettingsCard>

                        <!-- Diagnostic Info -->
                        <toolkit:SettingsExpander Header="Diagnostic Information">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <FontIcon Glyph="&#xEBE8;" ToolTipService.ToolTip="Enable diagnostic information and features. Some features need the application to be restarted." />
                            </toolkit:SettingsExpander.HeaderIcon>

                            <ToggleSwitch x:Name="DiagnosticInformation" Toggled="DiagnosticInformation_Toggled" />

                            <toolkit:SettingsExpander.Items>

                                <!-- Species Image Cache Subsection -->
                                <toolkit:SettingsExpander x:Name="SpeciesCacheExpander" Header="Species Image Cache">
                                    <toolkit:SettingsExpander.HeaderIcon>
                                        <FontIcon Glyph="&#xE8B9;" ToolTipService.ToolTip="Display the species fish image cache table." />
                                    </toolkit:SettingsExpander.HeaderIcon>

                                    <!-- Species Image Cache Refresh Button -->
                                    <Button Click="RefreshSpeciesStateView_Click"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Top"
                                                    ToolTipService.ToolTip="Refresh Species Cache View"
                                                    Visibility="{Binding IsExpanded, ElementName=SpeciesCacheExpander, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <FontIcon Glyph="&#xE72C;" />
                                            <TextBlock Text="Refresh" Margin="4,0,0,0" />
                                        </StackPanel>
                                    </Button>
                                    
                                    <toolkit:SettingsExpander.Items>
                                        <StackPanel Spacing="8">

                                            <!-- Species Cache DataGrid -->
                                            <dg:DataGrid ItemsSource="{x:Bind mainWindow.mediaStereoController.speciesImageCache.SpeciesStateView, Mode=OneWay}"
                                                     AutoGenerateColumns="False"
                                                     HeadersVisibility="Column"
                                                     CanUserSortColumns="True"
                                                     IsReadOnly="True"
                                                     GridLinesVisibility="Horizontal"
                                                     Height="300">
                                                <dg:DataGrid.Columns>
                                                    <dg:DataGridTextColumn Header="Genus" Binding="{Binding Genus}" />
                                                    <dg:DataGridTextColumn Header="Species" Binding="{Binding Species}" />
                                                    <dg:DataGridTextColumn Header="Code" Binding="{Binding Code}" />
                                                    <dg:DataGridTextColumn Header="State" Binding="{Binding CurrentState}" />
                                                    <dg:DataGridTextColumn Header="Total" Binding="{Binding TotalImages}" />
                                                    <dg:DataGridTextColumn Header="Count" Binding="{Binding ImageCount}" />
                                                    <dg:DataGridTextColumn Header="Downloaded" Binding="{Binding DownloadDate}" />
                                                </dg:DataGrid.Columns>
                                            </dg:DataGrid>

                                        </StackPanel>
                                    </toolkit:SettingsExpander.Items>
                                </toolkit:SettingsExpander>

                                <!-- Download / Upload Queue Subsection -->
                                <toolkit:SettingsExpander x:Name="DownloadUploadExpander" Header="Download / Upload Queue">
                                    <toolkit:SettingsExpander.HeaderIcon>
                                        <FontIcon Glyph="&#xEBD3;" ToolTipService.ToolTip="Display the internet download / upload queue." />
                                    </toolkit:SettingsExpander.HeaderIcon>

                                    <!-- Species Image Cache Refresh Button -->
                                    <Button Click="RefreshDownloadUploadView_Click"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Top"
                                                    ToolTipService.ToolTip="Refresh Download / Upload Queue View"
                                                    Visibility="{Binding IsExpanded, ElementName=DownloadUploadExpander, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <FontIcon Glyph="&#xE72C;" />
                                            <TextBlock Text="Refresh" Margin="4,0,0,0" />
                                        </StackPanel>
                                    </Button>

                                    <toolkit:SettingsExpander.Items>
                                        <StackPanel Spacing="8">

                                            <!-- Species Cache DataGrid -->
                                            <dg:DataGrid ItemsSource="{x:Bind mainWindow.downloadUploadManager.DownloadUploadView, Mode=OneWay}"
                                                     AutoGenerateColumns="False"
                                                     HeadersVisibility="Column"
                                                     CanUserSortColumns="True"
                                                     IsReadOnly="True"
                                                     GridLinesVisibility="Horizontal"
                                                     Height="300">
                                                <dg:DataGrid.Columns>
                                                    <dg:DataGridTextColumn Header="Direction" Binding="{Binding Direction}" />
                                                    <dg:DataGridTextColumn Header="Transfer Type" Binding="{Binding TransferType}" />
                                                    <dg:DataGridTextColumn Header="Status" Binding="{Binding Status}" />
                                                    <dg:DataGridTextColumn Header="Priority" Binding="{Binding Priority}" />
                                                    <dg:DataGridTextColumn Header="File" Binding="{Binding LocalFileSpec}" />
                                                    <dg:DataGridTextColumn Header="URL" Binding="{Binding URL}" />
                                                </dg:DataGrid.Columns>
                                            </dg:DataGrid>

                                        </StackPanel>
                                    </toolkit:SettingsExpander.Items>
                                </toolkit:SettingsExpander>

                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>
                    </toolkit:SettingsExpander.Items>
                </toolkit:SettingsExpander>

                <!-- CAMERA -->
                <toolkit:SettingsExpander Header="Camera" MaxWidth="1200">
                    <toolkit:SettingsExpander.HeaderIcon>
                        <FontIcon Glyph="&#xE722;" />
                    </toolkit:SettingsExpander.HeaderIcon>
                                            
                    <toolkit:SettingsExpander.Items>
                        <toolkit:SettingsCard Header="GoPro Setup" HorizontalContentAlignment="Left" ContentAlignment="Vertical">
                            <toolkit:SettingsCard.HeaderIcon>
                                <FontIcon Glyph="&#xED14;" />
                            </toolkit:SettingsCard.HeaderIcon>
                        </toolkit:SettingsCard>

                        <StackPanel Orientation="Vertical" Margin="50,10,50,0">
                            <TextBlock>
                                <TextBlock.Inlines>
                                    <Run Text="The GoPro survey cameras must have GoPro Labs installed on each camera. Follow the link to " />
                                    <Hyperlink NavigateUri="https://gopro.github.io/labs/">
                                        <Run Text="GoPro Labs" />
                                    </Hyperlink>
                                    <Run Text=".  Download the correct version for your GoPro." />
                                </TextBlock.Inlines>
                            </TextBlock>
                            <TextBlock Text="After Labs is installed on each GoPro switch each camera on and point at the QR Code below. After the GoPro has read the QR Code switch the camera off." TextWrapping="WrapWholeWords"/>
                            <TextBlock Text="The QR Code sets up the following:" TextWrapping="WrapWholeWords" Margin="0,10,0,0"/>
                            <TextBlock Margin="10,0,0,0">
                                <Run Text="• Sets the maximum MP4 file size of 64Gb" /><LineBreak/>
                                <Run Text="• Set the required resolution and frame rate" /><LineBreak/>
                                <Run Text="• Once switched on the GoPros will start recording with a firm shake of the camera rig" />
                            </TextBlock>
                            <Grid Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="50*"/>
                                    <ColumnDefinition Width="50*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Left">
                                    <DropDownButton x:Name="GoProQRSelection" Grid.Column="0" HorizontalAlignment="Left"  VerticalAlignment="Top" Content="Standard Setup">
                                        <DropDownButton.Flyout>
                                            <MenuFlyout x:Name="GoProQRSelectionFlyout"/>
                                        </DropDownButton.Flyout>
                                    </DropDownButton>
                                    <TextBlock x:Name="GoProQRScript" Text="" Grid.Column="0" Style="{StaticResource CaptionTextBlockStyle}" Margin="0,10,0,0" TextWrapping="WrapWholeWords"/>
                                </StackPanel>
                                <Image x:Name="GoProQRCode"  HorizontalAlignment="Right" Grid.Column="1" Width="400" Height="400" Margin="10,0,00,0"/>
                            </Grid>
                        </StackPanel>

                    </toolkit:SettingsExpander.Items>
                </toolkit:SettingsExpander>

                <!--  ABOUT  -->
                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="About" />
                <toolkit:SettingsExpander Description="© 2025 All rights reserved." Header="{StaticResource AppTitleName}" MaxWidth="1200">
                    <toolkit:SettingsExpander.HeaderIcon>
                        <BitmapIcon x:Name="AboutAppIcon" ShowAsMonochrome="False" UriSource="/Assets/surveyor-dark.png" />
                    </toolkit:SettingsExpander.HeaderIcon>
                    <TextBlock
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        IsTextSelectionEnabled="True"
                        Text="{x:Bind Version}" />
                    <toolkit:SettingsExpander.Items>

                        <toolkit:SettingsCard
                            HorizontalContentAlignment="Left"
                            ContentAlignment="Vertical"
                            Header="Dependencies &amp; references">
                            <StackPanel Margin="-12,0,0,0" Orientation="Vertical">
                                <HyperlinkButton Content="{x:Bind WinAppSdkRuntimeDetails}" NavigateUri="https://aka.ms/windowsappsdk" />
                                <HyperlinkButton Content="Windows UI Library" NavigateUri="https://aka.ms/winui" />
                                <HyperlinkButton Content="Windows Community Toolkit" NavigateUri="https://aka.ms/toolkit/windows" />
                                <HyperlinkButton Content="Win2D" NavigateUri="https://github.com/Microsoft/Win2D" />
                                <HyperlinkButton Content="OpenCV Apache 2.0 License"  NavigateUri="https://www.apache.org/licenses/LICENSE-2.0"/>
                                <HyperlinkButton Content="Emgu.CV GPL V3" NavigateUri="https://www.nuget.org/packages/Emgu.CV" />
                                <HyperlinkButton Content="Math.NET Numerics MIT License" NavigateUri="https://numerics.mathdotnet.com" />
                                <HyperlinkButton Content="Json.NET MIT License" NavigateUri="https://www.newtonsoft.com/json" />
                                <HyperlinkButton Content="Snorkeling mask icon from Noun Project CC BY 3.0" NavigateUri="https://thenounproject.com/icon/snorkeling-mask-1541410/" />
                                <HyperlinkButton Content="Fish icon created by Those Icons - Flaticon" NavigateUri="https://www.flaticon.com/free-icons/fish"/>
                                <HyperlinkButton Content="Media icon by Thea Graph from Noun Project CC BY 3.0" NavigateUri="https://thenounproject.com/browse/icons/term/media/" />
                                
                            </StackPanel>
                        </toolkit:SettingsCard>
                       
                    </toolkit:SettingsExpander.Items>
                </toolkit:SettingsExpander>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
